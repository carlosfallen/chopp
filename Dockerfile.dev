# FILE: Dockerfile.dev (para desenvolvimento)
FROM node:20-alpine

WORKDIR /app

# Instalar dependências do sistema
RUN apk add --no-cache \
    libc6-compat \
    sqlite \
    git \
    python3 \
    make \
    g++

# Instalar Wrangler globalmente
RUN npm install -g wrangler

# Copiar package files
COPY package*.json ./

# Instalar dependências
RUN npm ci

# Copiar código fonte
COPY . .

# Criar diretórios necessários
RUN mkdir -p .wrangler/state/v3/d1/miniflare-D1DatabaseObject
RUN mkdir -p uploads

# Copiar script de entrada
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

EXPOSE 4321
EXPOSE 8787

ENTRYPOINT ["docker-entrypoint.sh"]
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]