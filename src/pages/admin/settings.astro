---
// FILE: src/pages/admin/settings.astro
import AdminLayout from '../../layouts/AdminLayout.astro';
---

<AdminLayout title="Configura√ß√µes">
  <div class="admin-content">
    <div class="content-header">
      <div>
        <h1>Configura√ß√µes da Empresa</h1>
        <p>Gerencie os dados da empresa exibidos no site</p>
      </div>
      <button class="btn btn-primary" id="save-settings">
        üíæ Salvar Altera√ß√µes
      </button>
    </div>

    <div class="settings-container">
      <div class="settings-card">
        <h3>Informa√ß√µes B√°sicas</h3>
        <div class="form-group">
          <label for="brandName">Nome da Marca *</label>
          <input type="text" id="brandName" placeholder="ChoppExpress" required />
        </div>

        <div class="form-group">
          <label for="email">E-mail de Contato *</label>
          <input type="email" id="email" placeholder="contato@choppexpress.com" required />
        </div>

        <div class="form-group">
          <label for="whatsapp">WhatsApp (com c√≥digo do pa√≠s) *</label>
          <input type="tel" id="whatsapp" placeholder="5511999999999" required />
        </div>

        <div class="form-group">
          <label for="workingHours">Hor√°rio de Funcionamento</label>
          <input type="text" id="workingHours" placeholder="Seg-Dom: 8h √†s 22h" />
        </div>
      </div>

      <div class="settings-card">
        <h3>Redes Sociais</h3>
        <div class="form-group">
          <label for="instagram">Instagram (usu√°rio)</label>
          <input type="text" id="instagram" placeholder="@choppexpress" />
        </div>

        <div class="form-group">
          <label for="facebook">Facebook (URL)</label>
          <input type="url" id="facebook" placeholder="https://facebook.com/choppexpress" />
        </div>
      </div>

      <div class="settings-card">
        <h3>Endere√ßo</h3>
        <div class="form-group">
          <label for="address">Endere√ßo Completo</label>
          <textarea id="address" placeholder="Rua Exemplo, 123 - Bairro - Cidade/UF"></textarea>
        </div>
      </div>
    </div>
  </div>
</AdminLayout>

<style>
  .admin-content {
    padding: var(--spacing-2xl);
    max-width: 1200px;
    margin: 0 auto;
  }

  .content-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-2xl);
    flex-wrap: wrap;
    gap: var(--spacing-md);
  }

  .settings-container {
    display: grid;
    gap: var(--spacing-xl);
  }

  .settings-card {
    background: var(--color-bg-secondary);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-xl);
  }

  .settings-card h3 {
    margin-bottom: var(--spacing-lg);
    color: var(--color-accent-gold);
  }

  .form-group {
    margin-bottom: var(--spacing-lg);
  }

  .form-group label {
    display: block;
    margin-bottom: var(--spacing-xs);
    font-weight: 600;
    color: var(--color-text-secondary);
  }

  .form-group input,
  .form-group textarea {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--color-bg-primary);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius);
    color: var(--color-text-primary);
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.3s ease;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--color-accent-gold);
    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
  }

  .form-group textarea {
    min-height: 100px;
    resize: vertical;
  }
</style>

<script>
  async function loadSettings() {
    try {
      const response = await fetch('/api/settings');
      const data = await response.json();
      const settings = data.settings || {};

      (document.getElementById('brandName') as HTMLInputElement).value = settings.brandName || '';
      (document.getElementById('email') as HTMLInputElement).value = settings.email || '';
      (document.getElementById('whatsapp') as HTMLInputElement).value = settings.whatsapp || '';
      (document.getElementById('workingHours') as HTMLInputElement).value = settings.workingHours || '';
      (document.getElementById('instagram') as HTMLInputElement).value = settings.instagram || '';
      (document.getElementById('facebook') as HTMLInputElement).value = settings.facebook || '';
      (document.getElementById('address') as HTMLTextAreaElement).value = settings.address || '';
    } catch (error) {
      console.error('Error loading settings:', error);
    }
  }

  document.getElementById('save-settings')?.addEventListener('click', async () => {
    const settings = {
      brandName: (document.getElementById('brandName') as HTMLInputElement).value,
      email: (document.getElementById('email') as HTMLInputElement).value,
      whatsapp: (document.getElementById('whatsapp') as HTMLInputElement).value,
      workingHours: (document.getElementById('workingHours') as HTMLInputElement).value,
      instagram: (document.getElementById('instagram') as HTMLInputElement).value,
      facebook: (document.getElementById('facebook') as HTMLInputElement).value,
      address: (document.getElementById('address') as HTMLTextAreaElement).value,
    };

    if (!settings.brandName || !settings.email || !settings.whatsapp) {
      alert('Preencha todos os campos obrigat√≥rios');
      return;
    }

    try {
      const response = await fetch('/api/settings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(settings)
      });

      if (response.ok) {
        alert('Configura√ß√µes salvas com sucesso!');
      } else {
        throw new Error('Erro ao salvar');
      }
    } catch (error) {
      console.error('Error saving settings:', error);
      alert('Erro ao salvar configura√ß√µes');
    }
  });

  loadSettings();
</script>